<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "1c767a35642f753127dc08545c25a290",
  "translation_date": "2025-08-19T16:57:49+00:00",
  "source_file": "02-Security/README.md",
  "language_code": "bg"
}
-->
# MCP Сигурност: Цялостна защита за AI системи

[![MCP Security Best Practices](../../../translated_images/03.175aed6dedae133f9d41e49cefd0f0a9a39c3317e1eaa7ef7182696af7534308.bg.png)](https://youtu.be/88No8pw706o)

_(Кликнете върху изображението по-горе, за да гледате видеото на този урок)_

Сигурността е основополагаща за дизайна на AI системи, затова я поставяме като втори раздел. Това съответства на принципа на Microsoft **Secure by Design** от [Secure Future Initiative](https://www.microsoft.com/security/blog/2025/04/17/microsofts-secure-by-design-journey-one-year-of-success/).

Протоколът за контекст на модела (MCP) предоставя мощни нови възможности за приложения, задвижвани от AI, като същевременно въвежда уникални предизвикателства за сигурността, които надхвърлят традиционните рискове за софтуера. MCP системите се сблъскват както с утвърдени проблеми със сигурността (сигурно кодиране, минимални привилегии, сигурност на веригата за доставки), така и с нови заплахи, специфични за AI, включително инжектиране на подсказки, отравяне на инструменти, отвличане на сесии, атаки на объркан заместник, уязвимости при предаване на токени и динамична модификация на възможности.

Този урок разглежда най-критичните рискове за сигурността при внедряването на MCP—включително автентикация, авторизация, прекомерни разрешения, индиректно инжектиране на подсказки, сигурност на сесиите, проблеми с объркан заместник, управление на токени и уязвимости във веригата за доставки. Ще научите приложими контроли и добри практики за смекчаване на тези рискове, като използвате решения на Microsoft като Prompt Shields, Azure Content Safety и GitHub Advanced Security за укрепване на вашето MCP внедряване.

## Цели на обучението

До края на този урок ще можете:

- **Идентифициране на специфични заплахи за MCP**: Разпознаване на уникални рискове за сигурността в MCP системи, включително инжектиране на подсказки, отравяне на инструменти, прекомерни разрешения, отвличане на сесии, проблеми с объркан заместник, уязвимости при предаване на токени и рискове във веригата за доставки
- **Прилагане на контроли за сигурност**: Внедряване на ефективни мерки, включително надеждна автентикация, достъп с минимални привилегии, сигурно управление на токени, контроли за сигурност на сесиите и проверка на веригата за доставки
- **Използване на решения за сигурност на Microsoft**: Разбиране и внедряване на Microsoft Prompt Shields, Azure Content Safety и GitHub Advanced Security за защита на MCP работни натоварвания
- **Валидиране на сигурността на инструментите**: Разпознаване на важността на валидирането на метаданни на инструменти, мониторинг за динамични промени и защита срещу индиректни атаки с инжектиране на подсказки
- **Интегриране на добри практики**: Комбиниране на утвърдени основи за сигурност (сигурно кодиране, укрепване на сървъри, нулево доверие) със специфични контроли за MCP за цялостна защита

# MCP Архитектура за сигурност и контроли

Съвременните внедрения на MCP изискват многослойни подходи за сигурност, които адресират както традиционните проблеми със сигурността на софтуера, така и специфичните за AI заплахи. Бързо развиващата се спецификация на MCP продължава да усъвършенства своите контроли за сигурност, позволявайки по-добра интеграция с архитектури за сигурност на предприятия и утвърдени добри практики.

Изследванията от [Microsoft Digital Defense Report](https://aka.ms/mddr) показват, че **98% от докладваните пробиви биха могли да бъдат предотвратени чрез надеждна хигиена на сигурността**. Най-ефективната стратегия за защита комбинира основни практики за сигурност със специфични контроли за MCP—доказаните базови мерки за сигурност остават най-значими за намаляване на общия риск за сигурността.

## Текуща ситуация със сигурността

> **Note:** Тази информация отразява стандартите за сигурност на MCP към **18 август 2025 г.**. Протоколът MCP продължава да се развива бързо, а бъдещите внедрения може да въведат нови модели за автентикация и подобрени контроли. Винаги се консултирайте с текущата [MCP спецификация](https://spec.modelcontextprotocol.io/), [MCP GitHub хранилище](https://github.com/modelcontextprotocol) и [документация за добри практики за сигурност](https://modelcontextprotocol.io/specification/2025-06-18/basic/security_best_practices) за най-актуалните насоки.

### Еволюция на автентикацията в MCP

Спецификацията на MCP значително еволюира в подхода си към автентикация и авторизация:

- **Първоначален подход**: Ранните спецификации изискваха разработчиците да внедрят персонализирани сървъри за автентикация, като MCP сървърите действаха като OAuth 2.0 сървъри за авторизация, управляващи автентикацията на потребителите директно
- **Текущ стандарт (2025-06-18)**: Актуализираната спецификация позволява MCP сървърите да делегират автентикацията на външни доставчици на идентичност (като Microsoft Entra ID), подобрявайки сигурността и намалявайки сложността на внедряването
- **Сигурност на транспортния слой**: Подобрена поддръжка за сигурни транспортни механизми с подходящи модели за автентикация както за локални (STDIO), така и за отдалечени (Streamable HTTP) връзки

## Сигурност на автентикацията и авторизацията

### Текущи предизвикателства за сигурността

Съвременните внедрения на MCP се сблъскват с няколко предизвикателства, свързани с автентикацията и авторизацията:

### Рискове и заплахи

- **Неправилно конфигурирана логика за авторизация**: Грешки в имплементацията на авторизацията в MCP сървърите могат да изложат чувствителни данни и да приложат неправилни контроли за достъп
- **Компрометиране на OAuth токени**: Кражбата на токени от локални MCP сървъри позволява на нападателите да се представят за сървъри и да получат достъп до услуги надолу по веригата
- **Уязвимости при предаване на токени**: Неправилното управление на токени създава заобикаляне на контроли за сигурност и пропуски в отчетността
- **Прекомерни разрешения**: MCP сървъри с прекомерни привилегии нарушават принципа на минималните привилегии и разширяват повърхността за атаки

#### Предаване на токени: Критичен анти-модел

**Предаването на токени е изрично забранено** в текущата спецификация за авторизация на MCP поради сериозни последици за сигурността:

##### Заобикаляне на контроли за сигурност
- MCP сървърите и API-та надолу по веригата прилагат критични контроли за сигурност (ограничаване на скоростта, валидиране на заявки, мониторинг на трафика), които зависят от правилната валидиране на токени
- Директното използване на токени от клиенти към API заобикаля тези основни защити, подкопавайки архитектурата за сигурност

##### Предизвикателства за отчетност и одит  
- MCP сървърите не могат да различат клиенти, използващи токени, издадени от други източници, нарушавайки одитните следи
- Логовете на сървърите за ресурси надолу по веригата показват подвеждащи източници на заявки вместо реалните посредници MCP сървъри
- Разследването на инциденти и одитите за съответствие стават значително по-трудни

##### Рискове от изтичане на данни
- Невалидирани твърдения за токени позволяват на злонамерени актьори с откраднати токени да използват MCP сървъри като прокси за изтичане на данни
- Нарушения на границите на доверие позволяват неоторизирани модели на достъп, които заобикалят предвидените контроли за сигурност

##### Атаки между множество услуги
- Компрометирани токени, приети от множество услуги, позволяват странично движение между свързани системи
- Предположенията за доверие между услугите могат да бъдат нарушени, когато произходът на токените не може да бъде проверен

### Контроли за сигурност и мерки за смекчаване

**Критични изисквания за сигурност:**

> **MANDATORY**: MCP сървърите **НЕ ТРЯБВА** да приемат токени, които не са изрично издадени за MCP сървъра

#### Контроли за автентикация и авторизация

- **Стриктен преглед на авторизацията**: Провеждане на цялостни одити на логиката за авторизация на MCP сървърите, за да се гарантира, че само предвидените потребители и клиенти могат да получат достъп до чувствителни ресурси
  - **Ръководство за имплементация**: [Azure API Management като шлюз за автентикация за MCP сървъри](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
  - **Интеграция на идентичност**: [Използване на Microsoft Entra ID за автентикация на MCP сървъри](https://den.dev/blog/mcp-server-auth-entra-id-session/)

- **Сигурно управление на токени**: Внедряване на [най-добрите практики на Microsoft за валидиране и жизнен цикъл на токени](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens)
  - Валидиране на твърденията за аудитория на токени, за да съответстват на идентичността на MCP сървъра
  - Внедряване на подходящи политики за ротация и изтичане на токени
  - Предотвратяване на атаки с повторно използване на токени и неоторизирана употреба

- **Защитено съхранение на токени**: Сигурно съхранение на токени с криптиране както в покой, така и при пренос
  - **Добри практики**: [Насоки за сигурно съхранение и криптиране на токени](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)

#### Имплементация на контроли за достъп

- **Принцип на минималните привилегии**: Предоставяне на MCP сървърите само на минималните разрешения, необходими за предвидената функционалност
  - Редовни прегледи и актуализации на разрешенията, за да се предотврати натрупване на привилегии
  - **Документация на Microsoft**: [Сигурен достъп с минимални привилегии](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)

- **Контрол на достъпа, базиран на роли (RBAC)**: Внедряване на фино настроени роли
  - Ограничаване на ролите до конкретни ресурси и действия
  - Избягване на широки или ненужни разрешения, които разширяват повърхността за атаки

- **Непрекъснат мониторинг на разрешенията**: Внедряване на текущи одити и мониторинг на достъпа
  - Наблюдение на моделите на използване на разрешения за аномалии
  - Бързо отстраняване на прекомерни или неизползвани привилегии

## Специфични за AI заплахи за сигурността

### Атаки с инжектиране на подсказки и манипулация на инструменти

Съвременните внедрения на MCP се сблъскват със сложни вектори на атака, специфични за AI, които традиционните мерки за сигурност не могат напълно да адресират:

#### **Индиректно инжектиране на подсказки (Cross-Domain Prompt Injection)**

**Индиректното инжектиране на подсказки** представлява една от най-критичните уязвимости в AI системи, активирани от MCP. Нападателите вграждат злонамерени инструкции в външно съдържание—документи, уеб страници, имейли или източници на данни—които AI системите впоследствие обработват като легитимни команди.

**Сценарии на атака:**
- **Инжектиране чрез документи**: Злонамерени инструкции, скрити в обработени документи, които задействат нежелани действия от AI
- **Експлоатация на уеб съдържание**: Компрометирани уеб страници с вградени подсказки, които манипулират поведението на AI при извличане на данни
- **Атаки чрез имейли**: Злонамерени подсказки в имейли, които карат AI асистенти да изтичат информация или да извършват неоторизирани действия
- **Замърсяване на източници на данни**: Компрометирани бази данни или API-та, които предоставят заразено съдържание на AI системи

**Реално въздействие**: Тези атаки могат да доведат до изтичане на данни, нарушения на поверителността, генериране на вредно съдържание и манипулация на взаимодействията с потребителите. За подробен анализ вижте [Prompt Injection in MCP (Simon Willison)](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/).

![Prompt Injection Attack Diagram](../../../translated_images/prompt-injection.ed9fbfde297ca877c15bc6daa808681cd3c3dc7bf27bbbda342ef1ba5fc4f52d.bg.png)

#### **Атаки с отравяне на инструменти**

**Отравянето на инструменти** цели метаданните, които дефинират MCP инструментите, експлоатирайки начина, по който LLM интерпретират описанията и параметрите на инструментите, за да вземат решения за изпълнение.

**Механизми на атака:**
- **Манипулация на метаданни**: Нападателите вграждат злонамерени инструкции в описанията на инструменти, дефинициите на параметри или примери за употреба
- **Невидими инструкции**: Скритите подсказки в метаданните на инструменти, които се обработват от AI модели, но са невидими за човешките потребители
- **Динамична модификация на инструменти ("Rug Pulls")**: Инструменти, одобрени от потребители, по-късно се модифицират, за да извършват злонамерени действия без знанието на потребителя
- **Инжектиране на параметри**: Злонамерено съдържание, вградено в схеми на параметри на инструменти, което влияе на поведението на модела

**Рискове за хоствани сървъри**: Отдалечените MCP сървъри представляват повишени рискове, тъй като дефинициите на инструменти могат да бъдат актуализирани след първоначалното одобрение от потребителя, създавайки сценарии, при които преди безопасни инструменти стават злонамерени. За подробен анализ вижте [Tool Poisoning Attacks (Invariant Labs)](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks).

![Tool Injection Attack Diagram](../../../translated_images/tool-injection.3b0b4a6b24de6befe7d3afdeae44138ef005881aebcfc84c6f61369ce31e3640.bg.png)


- **Сигурно генериране на сесии**: Използвайте криптографски сигурни, недетерминистични идентификатори на сесии, генерирани със сигурни генератори на случайни числа.  
- **Обвързване с потребителя**: Обвържете идентификаторите на сесии с информация, специфична за потребителя, използвайки формати като `<user_id>:<session_id>`, за да предотвратите злоупотреба между потребители.  
- **Управление на жизнения цикъл на сесиите**: Въведете правилно изтичане, ротация и анулиране на сесиите, за да ограничите прозорците на уязвимост.  
- **Сигурност на транспорта**: Задължително използвайте HTTPS за цялата комуникация, за да предотвратите прихващане на идентификатори на сесии.  

### Проблем с объркания посредник  

**Проблемът с объркания посредник** възниква, когато MCP сървърите действат като проксита за удостоверяване между клиенти и трети страни, създавайки възможности за заобикаляне на авторизацията чрез експлоатация на статични идентификатори на клиенти.  

#### **Механизми на атаката и рискове**  

- **Заобикаляне на съгласие чрез бисквитки**: Предишно удостоверяване на потребител създава бисквитки за съгласие, които нападателите експлоатират чрез злонамерени заявки за авторизация с подправени URI за пренасочване.  
- **Кражба на кодове за авторизация**: Съществуващите бисквитки за съгласие могат да накарат сървърите за авторизация да пропуснат екрани за съгласие, пренасочвайки кодовете към контролирани от нападателя крайни точки.  
- **Неоторизиран достъп до API**: Откраднатите кодове за авторизация позволяват обмен на токени и имитация на потребители без изрично одобрение.  

#### **Стратегии за смекчаване**  

**Задължителни мерки:**  
- **Изискване за изрично съгласие**: MCP прокси сървърите, използващи статични идентификатори на клиенти, **ТРЯБВА** да получават съгласие от потребителя за всеки динамично регистриран клиент.  
- **Прилагане на OAuth 2.1 сигурност**: Следвайте актуалните най-добри практики за сигурност на OAuth, включително PKCE (Proof Key for Code Exchange) за всички заявки за авторизация.  
- **Строга валидация на клиентите**: Въведете строга проверка на URI за пренасочване и идентификаторите на клиентите, за да предотвратите експлоатация.  

### Уязвимости при предаване на токени  

**Предаването на токени** представлява явен антипатерн, при който MCP сървърите приемат клиентски токени без подходяща проверка и ги препращат към API-та надолу по веригата, нарушавайки спецификациите за авторизация на MCP.  

#### **Последици за сигурността**  

- **Заобикаляне на контрола**: Директното използване на токени от клиент към API заобикаля критични контроли като ограничаване на скоростта, валидация и мониторинг.  
- **Компрометиране на одитната следа**: Токените, издадени нагоре по веригата, правят идентифицирането на клиента невъзможно, нарушавайки възможностите за разследване на инциденти.  
- **Източване на данни чрез прокси**: Невалидираните токени позволяват на злонамерени актьори да използват сървърите като проксита за неоторизиран достъп до данни.  
- **Нарушаване на границите на доверие**: Предположенията за доверие на услугите надолу по веригата могат да бъдат нарушени, когато произходът на токените не може да бъде проверен.  
- **Разширяване на атаките между услуги**: Компрометираните токени, приети от множество услуги, позволяват странично движение.  

#### **Необходими мерки за сигурност**  

**Задължителни изисквания:**  
- **Валидация на токените**: MCP сървърите **НЕ ТРЯБВА** да приемат токени, които не са изрично издадени за MCP сървъра.  
- **Проверка на аудиторията**: Винаги проверявайте дали заявките за аудитория на токените съвпадат с идентичността на MCP сървъра.  
- **Правилен жизнен цикъл на токените**: Въведете краткотрайни токени за достъп с практики за сигурна ротация.  

## Сигурност на веригата за доставки за AI системи  

Сигурността на веригата за доставки се е развила отвъд традиционните софтуерни зависимости, обхващайки цялата AI екосистема. Съвременните MCP реализации трябва стриктно да проверяват и наблюдават всички AI компоненти, тъй като всеки от тях може да въведе потенциални уязвимости, които да компрометират целостта на системата.  

### Разширени компоненти на AI веригата за доставки  

**Традиционни софтуерни зависимости:**  
- Библиотеки с отворен код и рамки  
- Контейнерни изображения и базови системи  
- Инструменти за разработка и конвейери за изграждане  
- Инфраструктурни компоненти и услуги  

**AI-специфични елементи на веригата за доставки:**  
- **Основни модели**: Предварително обучени модели от различни доставчици, изискващи проверка на произхода  
- **Услуги за вграждане**: Външни услуги за векторизация и семантично търсене  
- **Доставчици на контекст**: Източници на данни, бази знания и хранилища на документи  
- **API на трети страни**: Външни AI услуги, ML конвейери и крайни точки за обработка на данни  
- **Артефакти на модела**: Тегла, конфигурации и варианти на модели с фина настройка  
- **Източници на данни за обучение**: Набори от данни, използвани за обучение и фина настройка на моделите  

### Цялостна стратегия за сигурност на веригата за доставки  

#### **Проверка на компонентите и доверие**  
- **Валидация на произхода**: Проверете произхода, лицензирането и целостта на всички AI компоненти преди интеграция.  
- **Оценка на сигурността**: Провеждайте сканиране за уязвимости и прегледи на сигурността за модели, източници на данни и AI услуги.  
- **Анализ на репутацията**: Оценете историята на сигурността и практиките на доставчиците на AI услуги.  
- **Проверка на съответствието**: Уверете се, че всички компоненти отговарят на изискванията за сигурност и регулации на организацията.  

#### **Сигурни конвейери за внедряване**  
- **Автоматизирана CI/CD сигурност**: Интегрирайте сканиране за сигурност в автоматизираните конвейери за внедряване.  
- **Целостта на артефактите**: Въведете криптографска проверка за всички внедрени артефакти (код, модели, конфигурации).  
- **Етапно внедряване**: Използвайте прогресивни стратегии за внедряване със сигурност на всеки етап.  
- **Доверени хранилища на артефакти**: Внедрявайте само от проверени, сигурни хранилища и регистри.  

#### **Непрекъснато наблюдение и реакция**  
- **Сканиране на зависимости**: Постоянно наблюдение за уязвимости във всички софтуерни и AI компоненти.  
- **Мониторинг на моделите**: Непрекъсната оценка на поведението на моделите, отклонения в производителността и аномалии в сигурността.  
- **Проследяване на здравето на услугите**: Наблюдавайте външни AI услуги за наличност, инциденти със сигурността и промени в политиките.  
- **Интеграция на разузнаване за заплахи**: Включете потоци за заплахи, специфични за AI и ML рискове.  

#### **Контрол на достъпа и минимални привилегии**  
- **Разрешения на ниво компонент**: Ограничете достъпа до модели, данни и услуги въз основа на бизнес необходимостта.  
- **Управление на акаунти за услуги**: Въведете специализирани акаунти за услуги с минимално изисквани разрешения.  
- **Сегментация на мрежата**: Изолирайте AI компонентите и ограничете мрежовия достъп между услугите.  
- **Контроли на API шлюзове**: Използвайте централизирани API шлюзове за контрол и наблюдение на достъпа до външни AI услуги.  

#### **Реакция при инциденти и възстановяване**  
- **Процедури за бърза реакция**: Установени процеси за коригиране или замяна на компрометирани AI компоненти.  
- **Ротация на идентификационни данни**: Автоматизирани системи за ротация на тайни, API ключове и идентификационни данни за услуги.  
- **Възможности за връщане назад**: Способност за бързо връщане към предишни известни добри версии на AI компонентите.  
- **Възстановяване след пробив във веригата за доставки**: Специфични процедури за реакция при компрометиране на AI услуги нагоре по веригата.  

...
### **Microsoft Security Solutions**
- [Документация за Microsoft Prompt Shields](https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection)
- [Услуга за безопасност на съдържанието в Azure](https://learn.microsoft.com/azure/ai-services/content-safety/)
- [Сигурност на Microsoft Entra ID](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- [Най-добри практики за управление на токени в Azure](https://learn.microsoft.com/entra/identity-platform/access-tokens)
- [Разширена сигурност в GitHub](https://github.com/security/advanced-security)

### **Ръководства за внедряване и уроци**
- [Azure API Management като шлюз за удостоверяване на MCP](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
- [Удостоверяване с Microsoft Entra ID за MCP сървъри](https://den.dev/blog/mcp-server-auth-entra-id-session/)
- [Сигурно съхранение и криптиране на токени (Видео)](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)

### **DevOps и сигурност на веригата за доставки**
- [Сигурност в Azure DevOps](https://azure.microsoft.com/products/devops)
- [Сигурност на Azure Repos](https://azure.microsoft.com/products/devops/repos/)
- [Пътят на Microsoft към сигурност на веригата за доставки](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)

## **Допълнителна документация за сигурност**

За изчерпателни насоки относно сигурността, вижте тези специализирани документи в този раздел:

- **[Най-добри практики за сигурност на MCP 2025](./mcp-security-best-practices-2025.md)** - Пълни най-добри практики за сигурност при внедряване на MCP
- **[Внедряване на безопасност на съдържанието в Azure](./azure-content-safety-implementation.md)** - Практически примери за интеграция на Azure Content Safety  
- **[Контроли за сигурност на MCP 2025](./mcp-security-controls-2025.md)** - Най-нови контроли и техники за сигурност при внедряване на MCP
- **[Бърза справка за най-добри практики на MCP](./mcp-best-practices.md)** - Ръководство за основни практики за сигурност на MCP

---

## Какво следва

Следва: [Глава 3: Първи стъпки](../03-GettingStarted/README.md)

**Отказ от отговорност**:  
Този документ е преведен с помощта на AI услуга за превод [Co-op Translator](https://github.com/Azure/co-op-translator). Въпреки че се стремим към точност, моля, имайте предвид, че автоматизираните преводи може да съдържат грешки или неточности. Оригиналният документ на неговия изходен език трябва да се счита за авторитетен източник. За критична информация се препоръчва професионален човешки превод. Ние не носим отговорност за каквито и да е недоразумения или погрешни интерпретации, произтичащи от използването на този превод.