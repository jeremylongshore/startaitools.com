<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "98bcd044860716da5819e31c152813b7",
  "translation_date": "2025-08-19T17:03:42+00:00",
  "source_file": "03-GettingStarted/07-aitk/README.md",
  "language_code": "bg"
}
-->
# Използване на сървър от разширението AI Toolkit за Visual Studio Code

Когато създавате AI агент, не става въпрос само за генериране на интелигентни отговори; важно е също така да дадете на вашия агент способността да предприема действия. Тук влиза в действие Model Context Protocol (MCP). MCP улеснява достъпа на агентите до външни инструменти и услуги по последователен начин. Представете си го като свързване на вашия агент към инструментариум, който той *наистина* може да използва.

Да кажем, че свържете агент към MCP сървър за калкулатор. Изведнъж вашият агент може да извършва математически операции само чрез получаване на заявка като „Колко е 47 умножено по 89?“—без нужда от твърдо кодирана логика или създаване на персонализирани API.

## Преглед

Този урок обхваща как да свържете MCP сървър за калкулатор към агент с разширението [AI Toolkit](https://aka.ms/AIToolkit) за Visual Studio Code, позволявайки на вашия агент да извършва математически операции като събиране, изваждане, умножение и деление чрез естествен език.

AI Toolkit е мощно разширение за Visual Studio Code, което улеснява разработката на агенти. AI инженери могат лесно да създават AI приложения, като разработват и тестват генеративни AI модели—локално или в облака. Разширението поддържа повечето основни генеративни модели, налични днес.

*Забележка*: AI Toolkit в момента поддържа Python и TypeScript.

## Цели на обучението

До края на този урок ще можете:

- Да използвате MCP сървър чрез AI Toolkit.
- Да конфигурирате агент, за да му позволите да открива и използва инструменти, предоставени от MCP сървър.
- Да използвате MCP инструменти чрез естествен език.

## Подход

Ето как трябва да подходим към това на високо ниво:

- Създайте агент и дефинирайте неговия системен prompt.
- Създайте MCP сървър с инструменти за калкулатор.
- Свържете Agent Builder към MCP сървър.
- Тествайте извикването на инструменти от агента чрез естествен език.

Чудесно, сега, когато разбираме процеса, нека конфигурираме AI агент, за да използва външни инструменти чрез MCP, подобрявайки неговите възможности!

## Предварителни изисквания

- [Visual Studio Code](https://code.visualstudio.com/)
- [AI Toolkit за Visual Studio Code](https://aka.ms/AIToolkit)

## Упражнение: Използване на сървър

> [!WARNING]
> Забележка за потребителите на macOS. В момента разследваме проблем, който засяга инсталирането на зависимости на macOS. В резултат на това потребителите на macOS няма да могат да завършат този урок към момента. Ще актуализираме инструкциите веднага щом бъде налично решение. Благодарим ви за търпението и разбирането!

В това упражнение ще създадете, стартирате и подобрите AI агент с инструменти от MCP сървър вътре в Visual Studio Code, използвайки AI Toolkit.

### -0- Предварителна стъпка: добавете модела OpenAI GPT-4o към My Models

Упражнението използва модела **GPT-4o**. Моделът трябва да бъде добавен към **My Models**, преди да създадете агента.

1. Отворете разширението **AI Toolkit** от **Activity Bar**.
1. В секцията **Catalog** изберете **Models**, за да отворите **Model Catalog**. Избирането на **Models** отваря **Model Catalog** в нов редакторски таб.
1. В полето за търсене на **Model Catalog** въведете **OpenAI GPT-4o**.
1. Кликнете върху **+ Add**, за да добавите модела към вашия списък **My Models**. Уверете се, че сте избрали модела, който е **Hosted by GitHub**.
1. В **Activity Bar** потвърдете, че моделът **OpenAI GPT-4o** се появява в списъка.

### -1- Създайте агент

**Agent (Prompt) Builder** ви позволява да създавате и персонализирате свои собствени AI агенти. В този раздел ще създадете нов агент и ще му зададете модел, който да захранва разговора.

1. Отворете разширението **AI Toolkit** от **Activity Bar**.
1. В секцията **Tools** изберете **Agent (Prompt) Builder**. Избирането на **Agent (Prompt) Builder** отваря **Agent (Prompt) Builder** в нов редакторски таб.
1. Кликнете върху бутона **+ New Agent**. Разширението ще стартира съветник за настройка чрез **Command Palette**.
1. Въведете името **Calculator Agent** и натиснете **Enter**.
1. В **Agent (Prompt) Builder**, за полето **Model**, изберете модела **OpenAI GPT-4o (via GitHub)**.

### -2- Създайте системен prompt за агента

След като сте създали структурата на агента, е време да дефинирате неговата личност и цел. В този раздел ще използвате функцията **Generate system prompt**, за да опишете предназначението на агента—в този случай агент за калкулатор—и ще позволите на модела да напише системния prompt вместо вас.

1. За секцията **Prompts** кликнете върху бутона **Generate system prompt**. Този бутон отваря prompt builder, който използва AI за генериране на системен prompt за агента.
1. В прозореца **Generate a prompt** въведете следното: `Вие сте полезен и ефективен математически асистент. Когато ви бъде даден проблем, включващ основна аритметика, отговаряте с правилния резултат.`
1. Кликнете върху бутона **Generate**. Ще се появи известие в долния десен ъгъл, потвърждаващо, че системният prompt се генерира. След като генерирането на prompt приключи, prompt ще се появи в полето **System prompt** на **Agent (Prompt) Builder**.
1. Прегледайте **System prompt** и го модифицирайте, ако е необходимо.

### -3- Създайте MCP сървър

След като сте дефинирали системния prompt на вашия агент—насочвайки неговото поведение и отговори—е време да оборудвате агента с практически способности. В този раздел ще създадете MCP сървър за калкулатор с инструменти за изпълнение на събиране, изваждане, умножение и деление. Този сървър ще позволи на вашия агент да извършва математически операции в реално време в отговор на заявки на естествен език.

AI Toolkit е оборудван с шаблони за улесняване на създаването на ваш собствен MCP сървър. Ще използваме Python шаблон за създаване на MCP сървър за калкулатор.

*Забележка*: AI Toolkit в момента поддържа Python и TypeScript.

1. В секцията **Tools** на **Agent (Prompt) Builder** кликнете върху бутона **+ MCP Server**. Разширението ще стартира съветник за настройка чрез **Command Palette**.
1. Изберете **+ Add Server**.
1. Изберете **Create a New MCP Server**.
1. Изберете **python-weather** като шаблон.
1. Изберете **Default folder**, за да запазите шаблона на MCP сървъра.
1. Въведете следното име за сървъра: **Calculator**
1. Ще се отвори нов прозорец на Visual Studio Code. Изберете **Yes, I trust the authors**.
1. Използвайки терминала (**Terminal** > **New Terminal**), създайте виртуална среда: `python -m venv .venv`
1. Използвайки терминала, активирайте виртуалната среда:
    1. Windows - `.venv\Scripts\activate`
    1. macOS/Linux - `source .venv/bin/activate`
1. Използвайки терминала, инсталирайте зависимостите: `pip install -e .[dev]`
1. В изгледа **Explorer** на **Activity Bar**, разширете директорията **src** и изберете **server.py**, за да отворите файла в редактора.
1. Заменете кода във файла **server.py** със следното и запазете:

    ```python
    """
    Sample MCP Calculator Server implementation in Python.

    
    This module demonstrates how to create a simple MCP server with calculator tools
    that can perform basic arithmetic operations (add, subtract, multiply, divide).
    """
    
    from mcp.server.fastmcp import FastMCP
    
    server = FastMCP("calculator")
    
    @server.tool()
    def add(a: float, b: float) -> float:
        """Add two numbers together and return the result."""
        return a + b
    
    @server.tool()
    def subtract(a: float, b: float) -> float:
        """Subtract b from a and return the result."""
        return a - b
    
    @server.tool()
    def multiply(a: float, b: float) -> float:
        """Multiply two numbers together and return the result."""
        return a * b
    
    @server.tool()
    def divide(a: float, b: float) -> float:
        """
        Divide a by b and return the result.
        
        Raises:
            ValueError: If b is zero
        """
        if b == 0:
            raise ValueError("Cannot divide by zero")
        return a / b
    ```

### -4- Стартирайте агента с MCP сървър за калкулатор

След като вашият агент има инструменти, е време да ги използва! В този раздел ще изпратите заявки към агента, за да тествате и валидирате дали агентът използва подходящия инструмент от MCP сървъра за калкулатор.

1. Натиснете `F5`, за да стартирате дебъгването на MCP сървъра. **Agent (Prompt) Builder** ще се отвори в нов редакторски таб. Статусът на сървъра е видим в терминала.
1. В полето **User prompt** на **Agent (Prompt) Builder** въведете следната заявка: `Купих 3 артикула на цена $25 всеки и използвах отстъпка от $20. Колко платих?`
1. Кликнете върху бутона **Run**, за да генерирате отговора на агента.
1. Прегледайте изхода на агента. Моделът трябва да заключи, че сте платили **$55**.
1. Ето разбивка на това, което трябва да се случи:
    - Агентът избира инструментите **multiply** и **subtract**, за да помогне в изчислението.
    - Съответните стойности `a` и `b` се задават за инструмента **multiply**.
    - Съответните стойности `a` и `b` се задават за инструмента **subtract**.
    - Отговорът от всеки инструмент се предоставя в съответния **Tool Response**.
    - Финалният изход от модела се предоставя във финалния **Model Response**.
1. Изпратете допълнителни заявки, за да тествате агента. Можете да модифицирате съществуващата заявка в полето **User prompt**, като кликнете в полето и замените съществуващата заявка.
1. След като приключите с тестването на агента, можете да спрете сървъра чрез **терминала**, като въведете **CTRL/CMD+C**, за да излезете.

## Задача

Опитайте да добавите допълнителен инструмент към вашия файл **server.py** (например: връщане на квадратен корен на число). Изпратете допълнителни заявки, които биха изисквали агентът да използва вашия нов инструмент (или съществуващи инструменти). Уверете се, че сте рестартирали сървъра, за да заредите новодобавените инструменти.

## Решение

[Решение](./solution/README.md)

## Основни изводи

Основните изводи от тази глава са следните:

- Разширението AI Toolkit е отличен клиент, който ви позволява да използвате MCP сървъри и техните инструменти.
- Можете да добавяте нови инструменти към MCP сървъри, разширявайки възможностите на агента, за да отговарят на променящите се изисквания.
- AI Toolkit включва шаблони (например Python MCP сървър шаблони), за да опрости създаването на персонализирани инструменти.

## Допълнителни ресурси

- [Документация за AI Toolkit](https://aka.ms/AIToolkit/doc)

## Какво следва
- Следва: [Тестване и дебъгване](../08-testing/README.md)

**Отказ от отговорност**:  
Този документ е преведен с помощта на AI услуга за превод [Co-op Translator](https://github.com/Azure/co-op-translator). Въпреки че се стремим към точност, моля, имайте предвид, че автоматизираните преводи може да съдържат грешки или неточности. Оригиналният документ на неговия роден език трябва да се счита за авторитетен източник. За критична информация се препоръчва професионален човешки превод. Не носим отговорност за недоразумения или погрешни интерпретации, произтичащи от използването на този превод.