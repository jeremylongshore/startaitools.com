<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "1c767a35642f753127dc08545c25a290",
  "translation_date": "2025-08-18T11:11:21+00:00",
  "source_file": "02-Security/README.md",
  "language_code": "ja"
}
-->
# MCPセキュリティ: AIシステムの包括的保護

[![MCPセキュリティのベストプラクティス](../../../translated_images/03.175aed6dedae133f9d41e49cefd0f0a9a39c3317e1eaa7ef7182696af7534308.ja.png)](https://youtu.be/88No8pw706o)

_(上の画像をクリックすると、このレッスンのビデオをご覧いただけます)_

セキュリティはAIシステム設計の基本であり、私たちはこれを第2セクションとして優先しています。これは、Microsoftの[Secure Future Initiative](https://www.microsoft.com/security/blog/2025/04/17/microsofts-secure-by-design-journey-one-year-of-success/)の**Secure by Design**原則と一致しています。

Model Context Protocol (MCP)は、AI駆動型アプリケーションに強力な新機能をもたらす一方で、従来のソフトウェアリスクを超えた独自のセキュリティ課題を導入します。MCPシステムは、既存のセキュリティ問題（安全なコーディング、最小権限、サプライチェーンセキュリティ）と、新しいAI特有の脅威（プロンプトインジェクション、ツールの汚染、セッションハイジャック、混乱した代理攻撃、トークンパススルーの脆弱性、動的能力の変更）に直面します。

このレッスンでは、MCP実装における最も重要なセキュリティリスクを探り、認証、認可、過剰な権限、間接的なプロンプトインジェクション、セッションセキュリティ、混乱した代理問題、トークン管理、サプライチェーンの脆弱性をカバーします。これらのリスクを軽減するための実用的なコントロールとベストプラクティスを学び、MicrosoftのPrompt Shields、Azure Content Safety、GitHub Advanced Securityなどのソリューションを活用してMCP展開を強化します。

## 学習目標

このレッスンの終了時には、以下ができるようになります:

- **MCP特有の脅威を特定する**: プロンプトインジェクション、ツールの汚染、過剰な権限、セッションハイジャック、混乱した代理問題、トークンパススルーの脆弱性、サプライチェーンリスクなど、MCPシステムにおける独自のセキュリティリスクを認識する
- **セキュリティコントロールを適用する**: 強力な認証、最小権限アクセス、安全なトークン管理、セッションセキュリティコントロール、サプライチェーン検証などの効果的な軽減策を実装する
- **Microsoftセキュリティソリューションを活用する**: MCPワークロード保護のためにMicrosoft Prompt Shields、Azure Content Safety、GitHub Advanced Securityを理解し展開する
- **ツールセキュリティを検証する**: ツールメタデータの検証、動的変更の監視、間接的なプロンプトインジェクション攻撃への防御の重要性を認識する
- **ベストプラクティスを統合する**: 安全なコーディング、サーバーの強化、ゼロトラストなどの確立されたセキュリティ基盤をMCP特有のコントロールと組み合わせて包括的な保護を実現する

# MCPセキュリティアーキテクチャとコントロール

現代のMCP実装では、従来のソフトウェアセキュリティとAI特有の脅威の両方に対応する層状のセキュリティアプローチが必要です。急速に進化するMCP仕様はセキュリティコントロールを成熟させ続けており、企業のセキュリティアーキテクチャや確立されたベストプラクティスとの統合を可能にしています。

[Microsoft Digital Defense Report](https://aka.ms/mddr)の研究によると、**報告された侵害の98%は堅牢なセキュリティ衛生によって防止可能**であることが示されています。最も効果的な保護戦略は、基盤的なセキュリティプラクティスとMCP特有のコントロールを組み合わせることであり、証明された基準セキュリティ対策は全体的なセキュリティリスクを削減する上で最も影響力があります。

## 現在のセキュリティ状況

> **Note:** この情報は**2025年8月18日**時点のMCPセキュリティ標準を反映しています。MCPプロトコルは急速に進化を続けており、将来の実装では新しい認証パターンや強化されたコントロールが導入される可能性があります。最新のガイダンスについては、常に現在の[MCP仕様](https://spec.modelcontextprotocol.io/)、[MCP GitHubリポジトリ](https://github.com/modelcontextprotocol)、および[セキュリティベストプラクティス文書](https://modelcontextprotocol.io/specification/2025-06-18/basic/security_best_practices)を参照してください。

### MCP認証の進化

MCP仕様は認証と認可のアプローチにおいて大きく進化してきました:

- **初期のアプローチ**: 初期の仕様では、開発者がカスタム認証サーバーを実装する必要があり、MCPサーバーがOAuth 2.0認証サーバーとして直接ユーザー認証を管理していました
- **現在の標準 (2025-06-18)**: 更新された仕様では、MCPサーバーが外部のIDプロバイダー（Microsoft Entra IDなど）に認証を委任することを可能にし、セキュリティ態勢を改善し、実装の複雑さを軽減しています
- **トランスポート層セキュリティ**: ローカル（STDIO）およびリモート（Streamable HTTP）接続の両方に適切な認証パターンを備えた安全なトランスポートメカニズムのサポートを強化

## 認証と認可のセキュリティ

### 現在のセキュリティ課題

現代のMCP実装は、認証と認可に関するいくつかの課題に直面しています:

### リスクと脅威ベクトル

- **誤った認可ロジック**: MCPサーバーの認可実装に欠陥があると、機密データが露出し、アクセスコントロールが誤って適用される可能性があります
- **OAuthトークンの漏洩**: ローカルMCPサーバートークンの盗難により、攻撃者がサーバーを偽装し、下流サービスにアクセスすることが可能になります
- **トークンパススルーの脆弱性**: トークン処理の不適切な取り扱いにより、セキュリティコントロールの回避や責任のギャップが生じます
- **過剰な権限**: 過剰な権限を持つMCPサーバーは最小権限の原則に違反し、攻撃対象を拡大します

#### トークンパススルー: 重大なアンチパターン

**トークンパススルーは、現在のMCP認可仕様において明確に禁止されています**。これは深刻なセキュリティ上の影響を伴うためです:

##### セキュリティコントロールの回避
- MCPサーバーと下流APIは、適切なトークン検証に依存する重要なセキュリティコントロール（レート制限、リクエスト検証、トラフィック監視）を実装しています
- クライアントからAPIへの直接トークン使用はこれらの重要な保護を回避し、セキュリティアーキテクチャを損ないます

##### 責任と監査の課題  
- MCPサーバーは、上流で発行されたトークンを使用するクライアントを区別できず、監査トレイルが破壊されます
- 下流リソースサーバーのログには、実際のMCPサーバーの仲介者ではなく誤解を招くリクエストの発信元が表示されます
- インシデント調査やコンプライアンス監査が著しく困難になります

##### データ漏洩リスク
- 検証されていないトークンクレームにより、盗まれたトークンを持つ悪意のあるアクターがMCPサーバーをプロキシとしてデータ漏洩を行うことが可能になります
- 信頼境界の違反により、意図されたセキュリティコントロールを回避する不正なアクセスパターンが発生します

##### マルチサービス攻撃ベクトル
- 複数のサービスで受け入れられるトークンが侵害されると、接続されたシステム間で横方向の移動が可能になります
- トークンの発信元を検証できない場合、サービス間の信頼仮定が破壊される可能性があります

### セキュリティコントロールと軽減策

**重要なセキュリティ要件:**

> **必須**: MCPサーバーは、MCPサーバーのために明示的に発行されたトークン以外を受け入れてはなりません

#### 認証と認可のコントロール

- **厳格な認可レビュー**: MCPサーバーの認可ロジックを包括的に監査し、意図されたユーザーとクライアントのみが機密リソースにアクセスできるようにする
  - **実装ガイド**: [Azure API ManagementをMCPサーバーの認証ゲートウェイとして使用する](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
  - **ID統合**: [Microsoft Entra IDを使用したMCPサーバー認証](https://den.dev/blog/mcp-server-auth-entra-id-session/)

- **安全なトークン管理**: [Microsoftのトークン検証とライフサイクルベストプラクティス](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens)を実装する
  - トークンのオーディエンスクレームがMCPサーバーのIDと一致することを検証する
  - 適切なトークンのローテーションと有効期限ポリシーを実施する
  - トークンのリプレイ攻撃や不正使用を防止する

- **保護されたトークンストレージ**: トークンの保存を暗号化し、静止状態および転送中の両方で安全に保つ
  - **ベストプラクティス**: [安全なトークンストレージと暗号化ガイドライン](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)

#### アクセスコントロールの実装

- **最小権限の原則**: MCPサーバーに必要最小限の権限のみを付与する
  - 権限の定期的なレビューと更新を行い、権限の肥大化を防止する
  - **Microsoftドキュメント**: [安全な最小権限アクセス](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)

- **ロールベースアクセスコントロール (RBAC)**: 細かいロール割り当てを実施する
  - ロールを特定のリソースとアクションに厳密にスコープする
  - 攻撃対象を拡大する広範または不要な権限を避ける

- **継続的な権限監視**: アクセスの監査と監視を継続的に実施する
  - 権限使用パターンの異常を監視する
  - 過剰または未使用の権限を迅速に修正する

## AI特有のセキュリティ脅威

### プロンプトインジェクションとツール操作攻撃

現代のMCP実装は、従来のセキュリティ対策では完全に対応できない高度なAI特有の攻撃ベクトルに直面しています:

#### **間接的なプロンプトインジェクション (クロスドメインプロンプトインジェクション)**

**間接的なプロンプトインジェクション**は、MCP対応AIシステムにおける最も重要な脆弱性の1つです。攻撃者は外部コンテンツ（文書、ウェブページ、メール、データソース）内に悪意のある指示を埋め込み、AIシステムがそれを正当なコマンドとして処理します。

**攻撃シナリオ:**
- **文書ベースのインジェクション**: 処理された文書内に隠された悪意のある指示が、意図しないAIアクションを引き起こす
- **ウェブコンテンツの悪用**: スクレイピング時にAIの動作を操作する埋め込みプロンプトを含む改ざんされたウェブページ
- **メールベースの攻撃**: メール内の悪意のあるプロンプトが、AIアシスタントに情報漏洩や不正なアクションを実行させる
- **データソースの汚染**: AIシステムに提供されるデータベースやAPIが改ざんされ、汚染されたコンテンツを提供する

**実世界の影響**: これらの攻撃は、データ漏洩、プライバシー侵害、有害なコンテンツの生成、ユーザーインタラクションの操作を引き起こす可能性があります。詳細な分析については、[MCPにおけるプロンプトインジェクション (Simon Willison)](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)をご覧ください。

![プロンプトインジェクション攻撃の図](../../../translated_images/prompt-injection.ed9fbfde297ca877c15bc6daa808681cd3c3dc7bf27bbbda342ef1ba5fc4f52d.ja.png)

#### **ツール汚染攻撃**

**ツール汚染**は、MCPツールを定義するメタデータを標的とし、LLMがツールの説明やパラメータを解釈して実行決定を行う方法を悪用します。

**攻撃メカニズム:**
- **メタデータ操作**: 攻撃者がツールの説明、パラメータ定義、使用例に悪意のある指示を注入する
- **不可視の指示**: ツールメタデータ内に隠されたプロンプトがAIモデルによって処理されるが、人間のユーザーには見えない
- **動的ツール変更 ("ラグプル")**: ユーザーによって承認されたツールが後に改ざんされ、ユーザーの認識なしに悪意のあるアクションを実行する
- **パラメータインジェクション**: ツールパラメータスキーマに埋め込まれた悪意のあるコンテンツがモデルの動作に影響を与える

**ホストサーバーのリスク**: リモートMCPサーバーは、ツール定義が初期のユーザー承認後に更新される可能性があるため、リスクが高まります。これにより、以前は安全だったツールが悪意のあるものに変わるシナリオが発生します。詳細な分析については、[ツール汚染攻撃 (Invariant Labs)](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)をご覧ください。

![ツールインジェクション攻撃の図](../../../translated_images/tool-injection.3b0b4a6b24de6befe7d3afdeae44138ef005881aebcfc84c6f61369ce31e3640.ja.png)

#### **その他のAI攻撃ベクトル**

- **クロスドメインプロンプトインジェクション (XPIA)**: 複数のドメインからのコンテンツを利用してセキュリティコントロールを回避する高度な攻撃
- **動的能力変更**: 初期のセキュリティ評価を逃れるツール能力のリアルタイム変更
- **コンテキストウィンドウ汚染**: 大規模なコンテキストウィンドウを操作
- **セッションの安全な生成**: 暗号的に安全で非決定論的なセッションIDを、セキュアな乱数生成器を使用して生成する  
- **ユーザー固有のバインディング**: セッションIDを `<user_id>:<session_id>` のような形式でユーザー固有の情報にバインドし、ユーザー間のセッション悪用を防ぐ  
- **セッションライフサイクル管理**: 適切な有効期限、ローテーション、無効化を実施し、脆弱性の窓を制限する  
- **通信の安全性**: セッションIDの傍受を防ぐため、すべての通信にHTTPSを必須とする  

### 混乱した代理問題

**混乱した代理問題**は、MCPサーバーがクライアントと第三者サービス間の認証プロキシとして機能する際に発生し、静的なクライアントIDの悪用による認可の回避を可能にします。

#### **攻撃の仕組みとリスク**

- **Cookieを利用した同意の回避**: 過去のユーザー認証により生成された同意Cookieを、攻撃者が悪意のある認可リクエストと改ざんされたリダイレクトURIを使用して悪用する  
- **認可コードの盗難**: 既存の同意Cookieにより認可サーバーが同意画面をスキップし、コードを攻撃者が制御するエンドポイントにリダイレクトする  
- **不正なAPIアクセス**: 盗まれた認可コードを使用してトークン交換を行い、明示的な承認なしにユーザーを偽装する  

#### **緩和策**

**必須の対策:**
- **明示的な同意の要求**: 静的クライアントIDを使用するMCPプロキシサーバーは、動的に登録されたクライアントごとにユーザーの同意を取得する必要があります  
- **OAuth 2.1のセキュリティ実装**: PKCE（Proof Key for Code Exchange）を含む最新のOAuthセキュリティベストプラクティスをすべての認可リクエストに適用する  
- **厳格なクライアント検証**: リダイレクトURIやクライアント識別子の厳密な検証を実施し、悪用を防ぐ  

### トークンパススルーの脆弱性  

**トークンパススルー**は、MCPサーバーがクライアントトークンを適切に検証せずに受け入れ、それを下流のAPIに転送することで、MCP認可仕様に違反する明確なアンチパターンを表します。

#### **セキュリティへの影響**

- **制御の回避**: クライアントからAPIへの直接的なトークン使用により、重要なレート制限、検証、監視制御が回避される  
- **監査証跡の破損**: 上流で発行されたトークンによりクライアントの識別が不可能となり、インシデント調査能力が損なわれる  
- **プロキシを利用したデータ漏洩**: 検証されていないトークンにより、攻撃者がサーバーをプロキシとして不正なデータアクセスを行う  
- **信頼境界の侵害**: トークンの発行元が確認できない場合、下流サービスの信頼仮定が破られる  
- **複数サービスへの攻撃拡大**: 複数のサービスで受け入れられるトークンが侵害されることで、横方向の移動が可能になる  

#### **必要なセキュリティ対策**

**必須要件:**
- **トークン検証**: MCPサーバーは、MCPサーバーのために明示的に発行されていないトークンを受け入れてはならない  
- **オーディエンス検証**: トークンのオーディエンスクレームがMCPサーバーのアイデンティティと一致することを常に検証する  
- **適切なトークンライフサイクル**: 短命のアクセストークンを安全なローテーションプラクティスで実装する  

## AIシステムのサプライチェーンセキュリティ

サプライチェーンセキュリティは、従来のソフトウェア依存関係を超えてAIエコシステム全体を対象とするよう進化しています。現代のMCP実装では、すべてのAI関連コンポーネントを厳密に検証および監視する必要があります。これらはシステムの整合性を損なう可能性のある脆弱性をもたらす可能性があります。

### 拡張されたAIサプライチェーンコンポーネント

**従来のソフトウェア依存関係:**
- オープンソースライブラリとフレームワーク  
- コンテナイメージとベースシステム  
- 開発ツールとビルドパイプライン  
- インフラストラクチャコンポーネントとサービス  

**AI特有のサプライチェーン要素:**
- **基盤モデル**: 各プロバイダーから提供される事前学習済みモデルの出所確認が必要  
- **埋め込みサービス**: 外部のベクトル化およびセマンティック検索サービス  
- **コンテキストプロバイダー**: データソース、知識ベース、文書リポジトリ  
- **サードパーティAPI**: 外部AIサービス、MLパイプライン、データ処理エンドポイント  
- **モデルアーティファクト**: 重み、構成、微調整されたモデルバリアント  
- **トレーニングデータソース**: モデルのトレーニングおよび微調整に使用されるデータセット  

### 包括的なサプライチェーンセキュリティ戦略

#### **コンポーネントの検証と信頼**
- **出所の検証**: 統合前にすべてのAIコンポーネントの出所、ライセンス、整合性を確認する  
- **セキュリティ評価**: モデル、データソース、AIサービスの脆弱性スキャンとセキュリティレビューを実施する  
- **評判分析**: AIサービスプロバイダーのセキュリティ実績と慣行を評価する  
- **コンプライアンス検証**: すべてのコンポーネントが組織のセキュリティおよび規制要件を満たしていることを確認する  

#### **安全なデプロイメントパイプライン**  
- **自動化されたCI/CDセキュリティ**: 自動化されたデプロイメントパイプライン全体でセキュリティスキャンを統合する  
- **アーティファクトの整合性**: デプロイされたすべてのアーティファクト（コード、モデル、構成）に暗号的検証を実施する  
- **段階的デプロイメント**: 各段階でセキュリティ検証を行う進行的デプロイメント戦略を使用する  
- **信頼できるアーティファクトリポジトリ**: 検証済みで安全なアーティファクトレジストリおよびリポジトリからのみデプロイする  

#### **継続的な監視と対応**
- **依存関係スキャン**: すべてのソフトウェアおよびAIコンポーネント依存関係の脆弱性を継続的に監視する  
- **モデル監視**: モデルの挙動、性能のドリフト、セキュリティ異常を継続的に評価する  
- **サービスの健全性追跡**: 外部AIサービスの可用性、セキュリティインシデント、ポリシー変更を監視する  
- **脅威インテリジェンス統合**: AIおよびMLセキュリティリスクに特化した脅威フィードを統合する  

#### **アクセス制御と最小権限**
- **コンポーネントレベルの権限**: ビジネス上必要な範囲でモデル、データ、サービスへのアクセスを制限する  
- **サービスアカウント管理**: 必要最小限の権限を持つ専用サービスアカウントを実装する  
- **ネットワークセグメンテーション**: AIコンポーネントを分離し、サービス間のネットワークアクセスを制限する  
- **APIゲートウェイ制御**: 外部AIサービスへのアクセスを制御および監視するために集中型APIゲートウェイを使用する  

#### **インシデント対応と復旧**
- **迅速な対応手順**: 侵害されたAIコンポーネントの修正または交換のための確立されたプロセス  
- **資格情報のローテーション**: 秘密情報、APIキー、サービス資格情報をローテーションする自動化システム  
- **ロールバック機能**: 以前の正常なバージョンのAIコンポーネントに迅速に戻る能力  
- **サプライチェーン侵害の復旧**: 上流のAIサービスの侵害に対応するための特定の手順  

### Microsoftセキュリティツールと統合

**GitHub Advanced Security**は以下を含む包括的なサプライチェーン保護を提供します:
- **秘密スキャン**: リポジトリ内の資格情報、APIキー、トークンの自動検出  
- **依存関係スキャン**: オープンソース依存関係とライブラリの脆弱性評価  
- **CodeQL分析**: セキュリティ脆弱性とコーディング問題の静的コード分析  
- **サプライチェーンインサイト**: 依存関係の健全性とセキュリティ状況の可視化  

**Azure DevOps & Azure Repos統合:**
- Microsoft開発プラットフォーム全体でのセキュリティスキャンのシームレスな統合  
- AIワークロードのAzure Pipelinesでの自動セキュリティチェック  
- 安全なAIコンポーネントデプロイメントのためのポリシー適用  

**Microsoft内部の実践:**
Microsoftはすべての製品にわたって広範なサプライチェーンセキュリティ慣行を実施しています。Microsoftのサプライチェーンセキュリティの取り組みについては、[The Journey to Secure the Software Supply Chain at Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)をご覧ください。  


### **Microsoft セキュリティソリューション**
- [Microsoft Prompt Shields ドキュメント](https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection)
- [Azure Content Safety サービス](https://learn.microsoft.com/azure/ai-services/content-safety/)
- [Microsoft Entra ID セキュリティ](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- [Azure トークン管理のベストプラクティス](https://learn.microsoft.com/entra/identity-platform/access-tokens)
- [GitHub Advanced Security](https://github.com/security/advanced-security)

### **実装ガイド & チュートリアル**
- [Azure API Management を MCP 認証ゲートウェイとして使用する](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
- [Microsoft Entra ID を使用した MCP サーバー認証](https://den.dev/blog/mcp-server-auth-entra-id-session/)
- [安全なトークンストレージと暗号化 (動画)](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)

### **DevOps & サプライチェーンセキュリティ**
- [Azure DevOps セキュリティ](https://azure.microsoft.com/products/devops)
- [Azure Repos セキュリティ](https://azure.microsoft.com/products/devops/repos/)
- [Microsoft サプライチェーンセキュリティの取り組み](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)

## **追加のセキュリティドキュメント**

包括的なセキュリティガイダンスについては、このセクションの専門的なドキュメントを参照してください:

- **[MCP セキュリティベストプラクティス 2025](./mcp-security-best-practices-2025.md)** - MCP 実装における完全なセキュリティベストプラクティス
- **[Azure Content Safety 実装](./azure-content-safety-implementation.md)** - Azure Content Safety 統合の実践的な実装例  
- **[MCP セキュリティコントロール 2025](./mcp-security-controls-2025.md)** - MCP 展開における最新のセキュリティコントロールと技術
- **[MCP ベストプラクティス クイックリファレンス](./mcp-best-practices.md)** - MCP セキュリティの基本的なベストプラクティスのクイックリファレンスガイド

---

## 次のステップ

次: [第3章: 始める](../03-GettingStarted/README.md)

**免責事項**:  
この文書は、AI翻訳サービス [Co-op Translator](https://github.com/Azure/co-op-translator) を使用して翻訳されています。正確性を追求しておりますが、自動翻訳には誤りや不正確な部分が含まれる可能性があります。元の言語で記載された原文が正式な情報源と見なされるべきです。重要な情報については、専門の人間による翻訳を推奨します。本翻訳の利用に起因する誤解や誤認について、当社は一切の責任を負いません。