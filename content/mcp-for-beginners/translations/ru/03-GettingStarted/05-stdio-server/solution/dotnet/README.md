<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "69372338676e01a2c97f42f70fdfbf42",
  "translation_date": "2025-08-26T20:16:19+00:00",
  "source_file": "03-GettingStarted/05-stdio-server/solution/dotnet/README.md",
  "language_code": "ru"
}
-->
# MCP stdio Server - .NET Решение

> **⚠️ Важно**: Это решение было обновлено для использования **stdio транспорта** в соответствии с рекомендациями спецификации MCP от 2025-06-18. Изначальный транспорт SSE устарел.

## Обзор

Это решение на .NET демонстрирует, как создать MCP сервер с использованием текущего stdio транспорта. Stdio транспорт проще, безопаснее и обеспечивает лучшую производительность по сравнению с устаревшим подходом SSE.

## Необходимые условия

- .NET 9.0 SDK или новее
- Базовые знания о внедрении зависимостей в .NET

## Инструкции по настройке

### Шаг 1: Восстановите зависимости

```bash
dotnet restore
```

### Шаг 2: Соберите проект

```bash
dotnet build
```

## Запуск сервера

Stdio сервер работает иначе, чем старый сервер на основе HTTP. Вместо запуска веб-сервера он взаимодействует через stdin/stdout:

```bash
dotnet run
```

**Важно**: Сервер может казаться "зависшим" — это нормально! Он ожидает JSON-RPC сообщения через stdin.

## Тестирование сервера

### Метод 1: Использование MCP Inspector (рекомендуется)

```bash
npx @modelcontextprotocol/inspector dotnet run
```

Это позволит:
1. Запустить ваш сервер как подпроцесс
2. Открыть веб-интерфейс для тестирования
3. Интерактивно тестировать все инструменты сервера

### Метод 2: Тестирование через командную строку

Вы также можете протестировать сервер, запустив Inspector напрямую:

```bash
npx @modelcontextprotocol/inspector dotnet run --project .
```

### Доступные инструменты

Сервер предоставляет следующие инструменты:

- **AddNumbers(a, b)**: Складывает два числа
- **MultiplyNumbers(a, b)**: Умножает два числа  
- **GetGreeting(name)**: Генерирует персонализированное приветствие
- **GetServerInfo()**: Предоставляет информацию о сервере

### Тестирование с помощью Claude Desktop

Чтобы использовать этот сервер с Claude Desktop, добавьте следующую конфигурацию в ваш `claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "example-stdio-server": {
      "command": "dotnet",
      "args": ["run", "--project", "path/to/server.csproj"]
    }
  }
}
```

## Структура проекта

```
dotnet/
├── Program.cs           # Main server setup and configuration
├── Tools.cs            # Tool implementations
├── server.csproj       # Project file with dependencies
├── server.sln         # Solution file
├── Properties/         # Project properties
└── README.md          # This file
```

## Основные отличия от HTTP/SSE

**Stdio транспорт (текущий):**
- ✅ Более простая настройка — веб-сервер не требуется
- ✅ Лучшая безопасность — отсутствуют HTTP-эндпоинты
- ✅ Использует `Host.CreateApplicationBuilder()` вместо `WebApplication.CreateBuilder()`
- ✅ `WithStdioTransport()` вместо `WithHttpTransport()`
- ✅ Консольное приложение вместо веб-приложения
- ✅ Лучшая производительность

**HTTP/SSE транспорт (устаревший):**
- ❌ Требовал веб-сервер ASP.NET Core
- ❌ Нужна была настройка маршрутизации через `app.MapMcp()`
- ❌ Более сложная конфигурация и зависимости
- ❌ Дополнительные соображения по безопасности
- ❌ Устарел в MCP 2025-06-18

## Возможности для разработки

- **Внедрение зависимостей**: Полная поддержка DI для сервисов и логирования
- **Структурированное логирование**: Корректное логирование в stderr с использованием `ILogger<T>`
- **Атрибуты инструментов**: Удобное определение инструментов с помощью атрибутов `[McpServerTool]`
- **Поддержка асинхронности**: Все инструменты поддерживают асинхронные операции
- **Обработка ошибок**: Элегантная обработка ошибок и логирование

## Советы по разработке

- Используйте `ILogger` для логирования (никогда не пишите напрямую в stdout)
- Собирайте проект с помощью `dotnet build` перед тестированием
- Тестируйте с помощью Inspector для визуальной отладки
- Все логи автоматически направляются в stderr
- Сервер корректно обрабатывает сигналы завершения работы

Это решение соответствует текущей спецификации MCP и демонстрирует лучшие практики для реализации stdio транспорта с использованием .NET.

---

**Отказ от ответственности**:  
Этот документ был переведен с помощью сервиса автоматического перевода [Co-op Translator](https://github.com/Azure/co-op-translator). Несмотря на наши усилия обеспечить точность, автоматические переводы могут содержать ошибки или неточности. Оригинальный документ на его родном языке следует считать авторитетным источником. Для получения критически важной информации рекомендуется профессиональный перевод человеком. Мы не несем ответственности за любые недоразумения или неправильные интерпретации, возникшие в результате использования данного перевода.