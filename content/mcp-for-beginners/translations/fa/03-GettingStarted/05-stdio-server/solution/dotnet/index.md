<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "69372338676e01a2c97f42f70fdfbf42",
  "translation_date": "2025-08-26T20:16:47+00:00",
  "source_file": "03-GettingStarted/05-stdio-server/solution/dotnet/README.md",
  "language_code": "fa"
}
-->
# سرور MCP stdio - راهکار .NET

> **⚠️ مهم**: این راهکار به‌روزرسانی شده است تا از **حمل‌ونقل stdio** استفاده کند، همان‌طور که در مشخصات MCP تاریخ ۱۸-۰۶-۲۰۲۵ توصیه شده است. حمل‌ونقل SSE قدیمی دیگر پشتیبانی نمی‌شود.

## مرور کلی

این راهکار .NET نشان می‌دهد که چگونه می‌توان یک سرور MCP با استفاده از حمل‌ونقل stdio فعلی ساخت. حمل‌ونقل stdio ساده‌تر، امن‌تر و عملکرد بهتری نسبت به روش SSE قدیمی ارائه می‌دهد.

## پیش‌نیازها

- .NET 9.0 SDK یا نسخه‌های جدیدتر
- آشنایی اولیه با تزریق وابستگی در .NET

## دستورالعمل‌های راه‌اندازی

### مرحله ۱: بازیابی وابستگی‌ها

```bash
dotnet restore
```

### مرحله ۲: ساخت پروژه

```bash
dotnet build
```

## اجرای سرور

سرور stdio به‌صورت متفاوتی نسبت به سرور قدیمی مبتنی بر HTTP اجرا می‌شود. به‌جای راه‌اندازی یک سرور وب، از طریق stdin/stdout ارتباط برقرار می‌کند:

```bash
dotnet run
```

**مهم**: سرور به نظر می‌رسد که متوقف شده است - این طبیعی است! سرور در حال انتظار برای دریافت پیام‌های JSON-RPC از stdin است.

## آزمایش سرور

### روش ۱: استفاده از MCP Inspector (توصیه‌شده)

```bash
npx @modelcontextprotocol/inspector dotnet run
```

این کار موارد زیر را انجام می‌دهد:
1. سرور شما را به‌عنوان یک فرآیند فرعی اجرا می‌کند
2. یک رابط وب برای آزمایش باز می‌کند
3. به شما امکان می‌دهد تمام ابزارهای سرور را به‌صورت تعاملی آزمایش کنید

### روش ۲: آزمایش مستقیم از طریق خط فرمان

همچنین می‌توانید با اجرای مستقیم Inspector آزمایش کنید:

```bash
npx @modelcontextprotocol/inspector dotnet run --project .
```

### ابزارهای موجود

سرور ابزارهای زیر را ارائه می‌دهد:

- **AddNumbers(a, b)**: جمع دو عدد
- **MultiplyNumbers(a, b)**: ضرب دو عدد  
- **GetGreeting(name)**: ایجاد یک پیام خوشامدگویی شخصی‌سازی‌شده
- **GetServerInfo()**: دریافت اطلاعات درباره سرور

### آزمایش با Claude Desktop

برای استفاده از این سرور با Claude Desktop، این پیکربندی را به فایل `claude_desktop_config.json` خود اضافه کنید:

```json
{
  "mcpServers": {
    "example-stdio-server": {
      "command": "dotnet",
      "args": ["run", "--project", "path/to/server.csproj"]
    }
  }
}
```

## ساختار پروژه

```
dotnet/
├── Program.cs           # Main server setup and configuration
├── Tools.cs            # Tool implementations
├── server.csproj       # Project file with dependencies
├── server.sln         # Solution file
├── Properties/         # Project properties
└── README.md          # This file
```

## تفاوت‌های کلیدی با HTTP/SSE

**حمل‌ونقل stdio (فعلی):**
- ✅ راه‌اندازی ساده‌تر - نیازی به سرور وب نیست
- ✅ امنیت بهتر - بدون نقاط پایانی HTTP
- ✅ استفاده از `Host.CreateApplicationBuilder()` به‌جای `WebApplication.CreateBuilder()`
- ✅ استفاده از `WithStdioTransport()` به‌جای `WithHttpTransport()`
- ✅ برنامه کنسولی به‌جای برنامه وب
- ✅ عملکرد بهتر

**حمل‌ونقل HTTP/SSE (قدیمی):**
- ❌ نیاز به سرور وب ASP.NET Core داشت
- ❌ نیاز به تنظیم مسیر `app.MapMcp()` داشت
- ❌ پیکربندی و وابستگی‌های پیچیده‌تر
- ❌ ملاحظات امنیتی اضافی
- ❌ اکنون در MCP تاریخ ۱۸-۰۶-۲۰۲۵ منسوخ شده است

## ویژگی‌های توسعه

- **تزریق وابستگی**: پشتیبانی کامل از DI برای سرویس‌ها و ثبت لاگ
- **ثبت لاگ ساختاریافته**: ثبت لاگ مناسب در stderr با استفاده از `ILogger<T>`
- **ویژگی‌های ابزار**: تعریف تمیز ابزارها با استفاده از ویژگی‌های `[McpServerTool]`
- **پشتیبانی از Async**: تمام ابزارها از عملیات async پشتیبانی می‌کنند
- **مدیریت خطا**: مدیریت خطا و ثبت لاگ به‌صورت مناسب

## نکات توسعه

- از `ILogger` برای ثبت لاگ استفاده کنید (هرگز مستقیماً به stdout ننویسید)
- قبل از آزمایش با `dotnet build` پروژه را بسازید
- برای اشکال‌زدایی بصری از Inspector استفاده کنید
- تمام لاگ‌ها به‌صورت خودکار به stderr ارسال می‌شوند
- سرور سیگنال‌های خاموشی را به‌صورت مناسب مدیریت می‌کند

این راهکار مطابق با مشخصات فعلی MCP است و بهترین شیوه‌ها برای پیاده‌سازی حمل‌ونقل stdio با استفاده از .NET را نشان می‌دهد.

---

**سلب مسئولیت**:  
این سند با استفاده از سرویس ترجمه هوش مصنوعی [Co-op Translator](https://github.com/Azure/co-op-translator) ترجمه شده است. در حالی که ما تلاش می‌کنیم دقت را رعایت کنیم، لطفاً توجه داشته باشید که ترجمه‌های خودکار ممکن است شامل خطاها یا نادرستی‌هایی باشند. سند اصلی به زبان اصلی آن باید به عنوان منبع معتبر در نظر گرفته شود. برای اطلاعات حساس، ترجمه حرفه‌ای انسانی توصیه می‌شود. ما هیچ مسئولیتی در قبال سوءتفاهم‌ها یا تفسیرهای نادرست ناشی از استفاده از این ترجمه نداریم.