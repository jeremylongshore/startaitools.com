<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "1d375ae049e52c89287d533daa4ba348",
  "translation_date": "2025-09-30T14:09:40+00:00",
  "source_file": "11-MCPServerHandsOnLabs/00-Introduction/README.md",
  "language_code": "fa"
}
-->
# معرفی به یکپارچه‌سازی پایگاه داده MCP

## 🎯 این آزمایشگاه چه چیزی را پوشش می‌دهد؟

این آزمایشگاه مقدماتی یک نمای کلی جامع از ساخت سرورهای پروتکل زمینه مدل (MCP) با یکپارچه‌سازی پایگاه داده ارائه می‌دهد. شما از طریق مطالعه موردی تحلیل‌های خرده‌فروشی Zava در https://github.com/microsoft/MCP-Server-and-PostgreSQL-Sample-Retail با موارد تجاری، معماری فنی و کاربردهای دنیای واقعی آشنا خواهید شد.

## مرور کلی

**پروتکل زمینه مدل (MCP)** به دستیارهای هوش مصنوعی امکان می‌دهد تا به صورت امن و در زمان واقعی به منابع داده خارجی دسترسی پیدا کرده و با آن‌ها تعامل داشته باشند. هنگامی که با یکپارچه‌سازی پایگاه داده ترکیب می‌شود، MCP قابلیت‌های قدرتمندی را برای برنامه‌های هوش مصنوعی مبتنی بر داده باز می‌کند.

این مسیر یادگیری به شما آموزش می‌دهد که چگونه سرورهای MCP آماده تولید بسازید که دستیارهای هوش مصنوعی را از طریق PostgreSQL به داده‌های فروش خرده‌فروشی متصل می‌کنند و الگوهای سازمانی مانند امنیت در سطح ردیف، جستجوی معنایی و دسترسی چند مستاجری به داده‌ها را پیاده‌سازی می‌کنند.

## اهداف یادگیری

در پایان این آزمایشگاه، شما قادر خواهید بود:

- **تعریف کنید** پروتکل زمینه مدل و مزایای اصلی آن برای یکپارچه‌سازی پایگاه داده
- **شناسایی کنید** اجزای کلیدی معماری سرور MCP با پایگاه داده‌ها
- **مطالعه کنید** مورد استفاده Zava Retail و نیازمندی‌های تجاری آن
- **تشخیص دهید** الگوهای سازمانی برای دسترسی امن و مقیاس‌پذیر به پایگاه داده
- **فهرست کنید** ابزارها و فناوری‌های استفاده شده در این مسیر یادگیری

## 🧭 چالش: هوش مصنوعی و داده‌های دنیای واقعی

### محدودیت‌های سنتی هوش مصنوعی

دستیارهای هوش مصنوعی مدرن بسیار قدرتمند هستند اما هنگام کار با داده‌های تجاری دنیای واقعی با محدودیت‌های قابل توجهی مواجه می‌شوند:

| **چالش** | **توضیحات** | **تأثیر تجاری** |
|----------|-------------|------------------|
| **دانش ایستا** | مدل‌های هوش مصنوعی که بر روی مجموعه داده‌های ثابت آموزش دیده‌اند نمی‌توانند به داده‌های جاری تجاری دسترسی پیدا کنند | بینش‌های قدیمی، فرصت‌های از دست رفته |
| **سیلوهای داده** | اطلاعات در پایگاه داده‌ها، APIها و سیستم‌هایی که هوش مصنوعی نمی‌تواند به آن‌ها دسترسی پیدا کند قفل شده‌اند | تحلیل ناقص، جریان‌های کاری پراکنده |
| **محدودیت‌های امنیتی** | دسترسی مستقیم به پایگاه داده‌ها نگرانی‌های امنیتی و انطباقی ایجاد می‌کند | استقرار محدود، آماده‌سازی دستی داده‌ها |
| **پرسش‌های پیچیده** | کاربران تجاری برای استخراج بینش‌های داده به دانش فنی نیاز دارند | کاهش پذیرش، فرآیندهای ناکارآمد |

### راه‌حل MCP

پروتکل زمینه مدل این چالش‌ها را با ارائه موارد زیر برطرف می‌کند:

- **دسترسی به داده‌های زمان واقعی**: دستیارهای هوش مصنوعی پایگاه داده‌ها و APIهای زنده را جستجو می‌کنند
- **یکپارچه‌سازی امن**: دسترسی کنترل‌شده با احراز هویت و مجوزها
- **رابط زبان طبیعی**: کاربران تجاری به زبان ساده سوال می‌پرسند
- **پروتکل استاندارد**: در پلتفرم‌ها و ابزارهای مختلف هوش مصنوعی کار می‌کند

## 🏪 آشنایی با Zava Retail: مطالعه موردی ما https://github.com/microsoft/MCP-Server-and-PostgreSQL-Sample-Retail

در طول این مسیر یادگیری، ما یک سرور MCP برای **Zava Retail**، یک زنجیره خرده‌فروشی DIY خیالی با چندین مکان فروشگاهی، خواهیم ساخت. این سناریوی واقعی پیاده‌سازی MCP در سطح سازمانی را نشان می‌دهد.

### زمینه تجاری

**Zava Retail** فعالیت می‌کند:
- **8 فروشگاه فیزیکی** در سراسر ایالت واشنگتن (سیاتل، بلویو، تاکوما، اسپوکین، اورت، ردموند، کرکلند)
- **1 فروشگاه آنلاین** برای فروش‌های تجارت الکترونیک
- **کاتالوگ محصولات متنوع** شامل ابزارها، سخت‌افزار، لوازم باغبانی و مصالح ساختمانی
- **مدیریت چندسطحی** با مدیران فروشگاه، مدیران منطقه‌ای و مدیران اجرایی

### نیازمندی‌های تجاری

مدیران فروشگاه و مدیران اجرایی به تحلیل‌های مبتنی بر هوش مصنوعی نیاز دارند تا:

1. **عملکرد فروش را تحلیل کنند** در فروشگاه‌ها و دوره‌های زمانی مختلف
2. **سطوح موجودی را پیگیری کنند** و نیازهای تأمین مجدد را شناسایی کنند
3. **رفتار مشتریان را درک کنند** و الگوهای خرید را شناسایی کنند
4. **بینش‌های محصول را کشف کنند** از طریق جستجوی معنایی
5. **گزارش‌ها را تولید کنند** با پرسش‌های زبان طبیعی
6. **امنیت داده‌ها را حفظ کنند** با کنترل دسترسی مبتنی بر نقش

### نیازمندی‌های فنی

سرور MCP باید ارائه دهد:

- **دسترسی چند مستاجری به داده‌ها** که در آن مدیران فروشگاه فقط داده‌های فروشگاه خود را ببینند
- **پرسش‌های انعطاف‌پذیر** که از عملیات پیچیده SQL پشتیبانی کند
- **جستجوی معنایی** برای کشف و پیشنهاد محصولات
- **داده‌های زمان واقعی** که وضعیت جاری کسب‌وکار را منعکس کند
- **احراز هویت امن** با امنیت در سطح ردیف
- **معماری مقیاس‌پذیر** که از کاربران همزمان متعدد پشتیبانی کند

## 🏗️ نمای کلی معماری سرور MCP

سرور MCP ما یک معماری لایه‌ای را پیاده‌سازی می‌کند که برای یکپارچه‌سازی پایگاه داده بهینه شده است:

```
┌─────────────────────────────────────────────────────────────┐
│                    VS Code AI Client                       │
│                  (Natural Language Queries)                │
└─────────────────────┬───────────────────────────────────────┘
                      │ HTTP/SSE
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                     MCP Server                             │
│  ┌─────────────────┐ ┌─────────────────┐ ┌───────────────┐ │
│  │   Tool Layer    │ │  Security Layer │ │  Config Layer │ │
│  │                 │ │                 │ │               │ │
│  │ • Query Tools   │ │ • RLS Context   │ │ • Environment │ │
│  │ • Schema Tools  │ │ • User Identity │ │ • Connections │ │
│  │ • Search Tools  │ │ • Access Control│ │ • Validation  │ │
│  └─────────────────┘ └─────────────────┘ └───────────────┘ │
└─────────────────────┬───────────────────────────────────────┘
                      │ asyncpg
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                PostgreSQL Database                         │
│  ┌─────────────────┐ ┌─────────────────┐ ┌───────────────┐ │
│  │  Retail Schema  │ │   RLS Policies  │ │   pgvector    │ │
│  │                 │ │                 │ │               │ │
│  │ • Stores        │ │ • Store-based   │ │ • Embeddings  │ │
│  │ • Customers     │ │   Isolation     │ │ • Similarity  │ │
│  │ • Products      │ │ • Role Control  │ │   Search      │ │
│  │ • Orders        │ │ • Audit Logs    │ │               │ │
│  └─────────────────┘ └─────────────────┘ └───────────────┘ │
└─────────────────────┬───────────────────────────────────────┘
                      │ REST API
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                  Azure OpenAI                              │
│               (Text Embeddings)                            │
└─────────────────────────────────────────────────────────────┘
```

### اجزای کلیدی

#### **1. لایه سرور MCP**
- **چارچوب FastMCP**: پیاده‌سازی مدرن سرور MCP با پایتون
- **ثبت ابزارها**: تعریف ابزارها به صورت اعلامی با ایمنی نوع
- **زمینه درخواست**: مدیریت هویت کاربر و جلسه
- **مدیریت خطا**: مدیریت خطا و ثبت گزارش قوی

#### **2. لایه یکپارچه‌سازی پایگاه داده**
- **مدیریت اتصال**: مدیریت کارآمد اتصال asyncpg
- **ارائه‌دهنده طرح‌واره**: کشف پویا طرح‌واره جدول‌ها
- **اجراکننده پرسش‌ها**: اجرای امن SQL با زمینه RLS
- **مدیریت تراکنش‌ها**: انطباق ACID و مدیریت بازگشت

#### **3. لایه امنیتی**
- **امنیت در سطح ردیف**: RLS PostgreSQL برای جداسازی داده‌های چند مستاجری
- **هویت کاربر**: احراز هویت و مجوز مدیر فروشگاه
- **کنترل دسترسی**: مجوزهای دقیق و ردگیری حسابرسی
- **اعتبارسنجی ورودی**: جلوگیری از تزریق SQL و اعتبارسنجی پرسش‌ها

#### **4. لایه تقویت هوش مصنوعی**
- **جستجوی معنایی**: جاسازی برداری برای کشف محصولات
- **یکپارچه‌سازی Azure OpenAI**: تولید جاسازی‌های متنی
- **الگوریتم‌های شباهت**: جستجوی شباهت کسینوسی pgvector
- **بهینه‌سازی جستجو**: نمایه‌سازی و تنظیم عملکرد

## 🔧 پشته فناوری

### فناوری‌های اصلی

| **جزء** | **فناوری** | **هدف** |
|---------|------------|----------|
| **چارچوب MCP** | FastMCP (پایتون) | پیاده‌سازی مدرن سرور MCP |
| **پایگاه داده** | PostgreSQL 17 + pgvector | داده‌های رابطه‌ای با جستجوی برداری |
| **خدمات هوش مصنوعی** | Azure OpenAI | جاسازی‌های متنی و مدل‌های زبانی |
| **کانتینری‌سازی** | Docker + Docker Compose | محیط توسعه |
| **پلتفرم ابری** | Microsoft Azure | استقرار تولید |
| **یکپارچه‌سازی IDE** | VS Code | چت هوش مصنوعی و جریان کاری توسعه |

### ابزارهای توسعه

| **ابزار** | **هدف** |
|-----------|----------|
| **asyncpg** | درایور PostgreSQL با عملکرد بالا |
| **Pydantic** | اعتبارسنجی و سریال‌سازی داده‌ها |
| **Azure SDK** | یکپارچه‌سازی خدمات ابری |
| **pytest** | چارچوب تست |
| **Docker** | کانتینری‌سازی و استقرار |

### پشته تولید

| **خدمت** | **منبع Azure** | **هدف** |
|----------|----------------|----------|
| **پایگاه داده** | Azure Database for PostgreSQL | خدمت پایگاه داده مدیریت‌شده |
| **کانتینر** | Azure Container Apps | میزبانی کانتینر بدون سرور |
| **خدمات هوش مصنوعی** | Azure AI Foundry | مدل‌ها و نقاط پایانی OpenAI |
| **نظارت** | Application Insights | مشاهده‌پذیری و تشخیص‌ها |
| **امنیت** | Azure Key Vault | مدیریت اسرار و پیکربندی |

## 🎬 سناریوهای استفاده دنیای واقعی

بیایید بررسی کنیم که چگونه کاربران مختلف با سرور MCP ما تعامل دارند:

### سناریو 1: بررسی عملکرد مدیر فروشگاه

**کاربر**: سارا، مدیر فروشگاه سیاتل  
**هدف**: تحلیل عملکرد فروش سه‌ماهه گذشته

**پرسش زبان طبیعی**:
> "10 محصول برتر از نظر درآمد برای فروشگاه من در سه‌ماهه چهارم 2024 را نشان بده"

**چه اتفاقی می‌افتد**:
1. چت هوش مصنوعی VS Code پرسش را به سرور MCP ارسال می‌کند
2. سرور MCP زمینه فروشگاه سارا (سیاتل) را شناسایی می‌کند
3. سیاست‌های RLS داده‌ها را فقط به فروشگاه سیاتل فیلتر می‌کنند
4. پرسش SQL تولید و اجرا می‌شود
5. نتایج قالب‌بندی شده و به چت هوش مصنوعی بازگردانده می‌شود
6. هوش مصنوعی تحلیل و بینش‌ها را ارائه می‌دهد

### سناریو 2: کشف محصول با جستجوی معنایی

**کاربر**: مایک، مدیر موجودی  
**هدف**: یافتن محصولاتی مشابه درخواست مشتری

**پرسش زبان طبیعی**:
> "چه محصولاتی می‌فروشیم که مشابه 'اتصالات الکتریکی ضدآب برای استفاده در فضای باز' باشند؟"

**چه اتفاقی می‌افتد**:
1. پرسش توسط ابزار جستجوی معنایی پردازش می‌شود
2. Azure OpenAI بردار جاسازی تولید می‌کند
3. pgvector جستجوی شباهت را انجام می‌دهد
4. محصولات مرتبط بر اساس ارتباط رتبه‌بندی می‌شوند
5. نتایج شامل جزئیات محصول و موجودی است
6. هوش مصنوعی جایگزین‌ها و فرصت‌های بسته‌بندی را پیشنهاد می‌دهد

### سناریو 3: تحلیل بین فروشگاه‌ها

**کاربر**: جنیفر، مدیر منطقه‌ای  
**هدف**: مقایسه عملکرد در تمام فروشگاه‌ها

**پرسش زبان طبیعی**:
> "فروش بر اساس دسته‌بندی را برای تمام فروشگاه‌ها در 6 ماه گذشته مقایسه کن"

**چه اتفاقی می‌افتد**:
1. زمینه RLS برای دسترسی مدیر منطقه‌ای تنظیم می‌شود
2. پرسش پیچیده چندفروشگاهی تولید می‌شود
3. داده‌ها در مکان‌های فروشگاه تجمیع می‌شوند
4. نتایج شامل روندها و مقایسه‌ها است
5. هوش مصنوعی بینش‌ها و توصیه‌ها را شناسایی می‌کند

## 🔒 بررسی عمیق امنیت و چند مستاجری

پیاده‌سازی ما امنیت در سطح سازمانی را در اولویت قرار می‌دهد:

### امنیت در سطح ردیف (RLS)

RLS PostgreSQL جداسازی داده‌ها را تضمین می‌کند:

```sql
-- Store managers see only their store's data
CREATE POLICY store_manager_policy ON retail.orders
  FOR ALL TO store_managers
  USING (store_id = get_current_user_store());

-- Regional managers see multiple stores
CREATE POLICY regional_manager_policy ON retail.orders
  FOR ALL TO regional_managers
  USING (store_id = ANY(get_user_store_list()));
```

### مدیریت هویت کاربر

هر اتصال MCP شامل موارد زیر است:
- **شناسه مدیر فروشگاه**: شناسه منحصربه‌فرد برای زمینه RLS
- **تخصیص نقش**: مجوزها و سطوح دسترسی
- **مدیریت جلسه**: توکن‌های احراز هویت امن
- **ثبت حسابرسی**: تاریخچه کامل دسترسی

### حفاظت از داده‌ها

چندین لایه امنیتی:
- **رمزگذاری اتصال**: TLS برای تمام اتصالات پایگاه داده
- **جلوگیری از تزریق SQL**: فقط پرسش‌های پارامتری
- **اعتبارسنجی ورودی**: اعتبارسنجی جامع درخواست‌ها
- **مدیریت خطا**: عدم نمایش داده‌های حساس در پیام‌های خطا

## 🎯 نکات کلیدی

پس از تکمیل این مقدمه، شما باید درک کنید:

✅ **ارزش MCP**: چگونه MCP دستیارهای هوش مصنوعی و داده‌های دنیای واقعی را به هم متصل می‌کند  
✅ **زمینه تجاری**: نیازمندی‌ها و چالش‌های Zava Retail  
✅ **نمای کلی معماری**: اجزای کلیدی و تعاملات آن‌ها  
✅ **پشته فناوری**: ابزارها و چارچوب‌های استفاده شده  
✅ **مدل امنیتی**: دسترسی چند مستاجری به داده‌ها و حفاظت  
✅ **الگوهای استفاده**: سناریوهای پرسش دنیای واقعی و جریان‌های کاری  

## 🚀 گام بعدی

آماده‌اید عمیق‌تر شوید؟ ادامه دهید با:

**[آزمایشگاه 01: مفاهیم اصلی معماری](../01-Architecture/README.md)**

درباره الگوهای معماری سرور MCP، اصول طراحی پایگاه داده و پیاده‌سازی فنی دقیق که راه‌حل تحلیل خرده‌فروشی ما را قدرت می‌بخشد، بیاموزید.

## 📚 منابع اضافی

### مستندات MCP
- [مشخصات MCP](https://modelcontextprotocol.io/docs/) - مستندات رسمی پروتکل  
- [MCP برای مبتدیان](https://aka.ms/mcp-for-beginners) - راهنمای جامع یادگیری MCP  
- [مستندات FastMCP](https://github.com/modelcontextprotocol/python-sdk) - مستندات SDK پایتون  

### یکپارچه‌سازی پایگاه داده
- [مستندات PostgreSQL](https://www.postgresql.org/docs/) - مرجع کامل PostgreSQL  
- [راهنمای pgvector](https://github.com/pgvector/pgvector) - مستندات افزونه برداری  
- [امنیت در سطح ردیف](https://www.postgresql.org/docs/current/ddl-rowsecurity.html) - راهنمای RLS PostgreSQL  

### خدمات Azure
- [مستندات Azure OpenAI](https://docs.microsoft.com/azure/cognitive-services/openai/) - یکپارچه‌سازی خدمات هوش مصنوعی  
- [Azure Database for PostgreSQL](https://docs.microsoft.com/azure/postgresql/) - خدمت پایگاه داده مدیریت‌شده  
- [Azure Container Apps](https://docs.microsoft.com/azure/container-apps/) - کانتینرهای بدون سرور  

---

**سلب مسئولیت**: این یک تمرین یادگیری با داده‌های خرده‌فروشی خیالی است. همیشه هنگام پیاده‌سازی راه‌حل‌های مشابه در محیط‌های تولید، از سیاست‌های حاکمیت داده و امنیت سازمان خود پیروی کنید.

---

**سلب مسئولیت**:  
این سند با استفاده از سرویس ترجمه هوش مصنوعی [Co-op Translator](https://github.com/Azure/co-op-translator) ترجمه شده است. در حالی که ما تلاش می‌کنیم دقت را حفظ کنیم، لطفاً توجه داشته باشید که ترجمه‌های خودکار ممکن است شامل خطاها یا نادرستی‌ها باشند. سند اصلی به زبان اصلی آن باید به عنوان منبع معتبر در نظر گرفته شود. برای اطلاعات حساس، ترجمه حرفه‌ای انسانی توصیه می‌شود. ما مسئولیتی در قبال سوء تفاهم‌ها یا تفسیرهای نادرست ناشی از استفاده از این ترجمه نداریم.